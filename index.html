<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Desafio Durín</title>

  <style>
    body {
      margin: 0;
      background: #b00000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: Arial, sans-serif;
      color: #fff;
      touch-action: none;
    }

    #info {
      margin-bottom: 8px;
      font-size: 16px;
    }

    canvas {
      background: #b00000;
      border: 3px solid #ffffff;
    }

    #controls button {
      font-size: 20px;
      padding: 8px 14px;
      margin: 3px;
    }

    #overlay {
      position: absolute;
      inset: 0;
      background: rgba(176, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      text-align: center;
    }

    #overlay button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 12px;
    }
  </style>
</head>

<body>

  <div id="info">
    Pontos: <span id="score">0</span> |
    Fase: <span id="level">1</span>
  </div>

  <canvas id="game" width="360" height="360"></canvas>

  <div id="controls">
    <button onclick="setDir(0,-1)">⬆️</button><br>
    <button onclick="setDir(-1,0)">⬅️</button>
    <button onclick="setDir(1,0)">➡️</button><br>
    <button onclick="setDir(0,1)">⬇️</button>
  </div>

  <div id="overlay">
    <h1>Desafio Durín</h1>
    <p>Controle a formiga e colete os produtos Durín</p>
    <button onclick="startGame()">Iniciar Jogo</button>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const grid = 20;
    let score = 0;
    let level = 1;
    let speed = 200;
    let started = false;

    let ant = [{ x: 180, y: 180 }];
    let dx = grid;
    let dy = 0;

    let item = randomPosition();
    let bonus = null;

    function randomPosition() {
      return {
        x: Math.floor(Math.random() * (canvas.width / grid)) * grid,
        y: Math.floor(Math.random() * (canvas.height / grid)) * grid
      };
    }

    function setDir(x, y) {
      if (x !== -dx / grid && y !== -dy / grid) {
        dx = x * grid;
        dy = y * grid;
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp") setDir(0, -1);
      if (e.key === "ArrowDown") setDir(0, 1);
      if (e.key === "ArrowLeft") setDir(-1, 0);
      if (e.key === "ArrowRight") setDir(1, 0);
    });

    function drawAnt() {
      ant.forEach((segment, index) => {
        ctx.fillStyle = index === 0 ? "#ffffff" : "#dddddd";
        ctx.fillRect(segment.x, segment.y, grid, grid);
      });
    }

    function drawItem() {
      ctx.fillStyle = "#f5f5f5";
      ctx.fillRect(item.x, item.y, grid, grid);
    }

    function drawBonus() {
      if (bonus) {
        ctx.fillStyle = "#ffcc00";
        ctx.fillRect(bonus.x, bonus.y, grid, grid);
        ctx.fillStyle = "#000";
        ctx.font = "12px Arial";
        ctx.fillText("D", bonus.x + 6, bonus.y + 14);
      }
    }

    function update() {
      const head = { x: ant[0].x + dx, y: ant[0].y + dy };

      if (
        head.x < 0 || head.y < 0 ||
        head.x >= canvas.width || head.y >= canvas.height
      ) {
        endGame();
        return;
      }

      ant.unshift(head);

      if (head.x === item.x && head.y === item.y) {
        score += 10;
        item = randomPosition();
        checkLevel();
      } else if (bonus && head.x === bonus.x && head.y === bonus.y) {
        score += 50;
        bonus = null;
        checkLevel();
      } else {
        ant.pop();
      }
    }

    function checkLevel() {
      const newLevel = Math.floor(score / 100) + 1;

      if (newLevel !== level && newLevel <= 10) {
        level = newLevel;
        speed = Math.max(60, speed - 15);

        if ([3, 6, 9].includes(level)) {
          bonus = randomPosition();
        }
      }

      document.getElementById("score").innerText = score;
      document.getElementById("level").innerText = level;
    }

    function endGame() {
      started = false;
      document.getElementById("overlay").style.display = "flex";
      document.getElementById("overlay").innerHTML = `
        <h1>Parabéns!</h1>
        <p>Sua pontuação final foi <strong>${score}</strong></p>
        <p>Durín Indústria de Plásticos</p>
        <button onclick="restart()">Jogar Novamente</button>
      `;
    }

    function restart() {
      score = 0;
      level = 1;
      speed = 200;
      ant = [{ x: 180, y: 180 }];
      dx = grid;
      dy = 0;
      item = randomPosition();
      bonus = null;

      document.getElementById("score").innerText = score;
      document.getElementById("level").innerText = level;

      startGame();
    }
function gameLoop() {
  requestAnimationFrame(gameLoop);

  if (++count < speed) return;
  count = 0;

  ant.x += ant.dx;
  ant.y += ant.dy;

  if (ant.x < 0) ant.x = canvas.width - grid;
  if (ant.x >= canvas.width) ant.x = 0;
  if (ant.y < 0) ant.y = canvas.height - grid;
  if (ant.y >= canvas.height) ant.y = 0;

  if (ant.x === food.x && ant.y === food.y) {
    score += 10;
    document.getElementById("score").innerText = score;
    food = spawnFood();

    if (score % 100 === 0) {
      level++;
      speed = Math.max(2, speed - 1);
      document.getElementById("level").innerText = level;
    }
  }

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  /* TORNEIRA / ASSENTO (OBJETO) */
  ctx.fillStyle = "#ffffff";
  ctx.beginPath();
  ctx.arc(food.x + grid/2, food.y + grid/2, grid/2, 0, Math.PI * 2);
  ctx.fill();

  ctx.fillStyle = "#b30000";
  ctx.fillRect(food.x + 4, food.y + 8, 10, 4);

  /* FORMIGA DURÍN */
  ctx.fillStyle = "#000000";
  ctx.beginPath();
  ctx.arc(ant.x + 6, ant.y + 9, 4, 0, Math.PI * 2);
  ctx.arc(ant.x + 12, ant.y + 9, 5, 0, Math.PI * 2);
  ctx.arc(ant.x + 18, ant.y + 9, 4, 0, Math.PI * 2);
  ctx.fill();

  /* ANTENAS */
  ctx.strokeStyle = "#000";
  ctx.beginPath();
  ctx.moveTo(ant.x + 10, ant.y + 4);
  ctx.lineTo(ant.x + 6, ant.y);
  ctx.moveTo(ant.x + 14, ant.y + 4);
  ctx.lineTo(ant.x + 18, ant.y);
  ctx.stroke();
      }
    
